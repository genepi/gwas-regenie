/*
========================================================================================
    Nextflow config file for running tests
========================================================================================
*/

params {

  project                       = 'test-gwas-delete-missing-phenotype-data'
  genotypes_array               = 'tests/input/pipeline/example.{bim,bed,fam}'
  genotypes_imputed             = 'tests/input/pipeline/example.vcf.gz'
  genotypes_build               = 'hg19'
  genotypes_imputed_format      = 'vcf'
  phenotypes_filename           = 'tests/input/pipeline/phenotype.txt'
  phenotypes_columns            = 'Y1,Y2'
  phenotypes_binary_trait       = false
  phenotypes_delete_missings    = true
  regenie_test                  = 'additive'
  rsids_filename                = "$baseDir/tests/input/pipeline/rsids.tsv.gz"

}

process {

  withName: 'VALIDATE_PHENOTYPES' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'VALIDATE_COVARIATES' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'CHUNK_ASSOCIATION_FILES' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'COMBINE_MANIFEST_FILES' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'QC_FILTER_GENOTYPED' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'PRUNE_GENOTYPED' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'IMPUTED_TO_PLINK2' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REGENIE_STEP1' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REGENIE_STEP1_SPLIT' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REGENIE_STEP1_RUN_CHUNK' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REGENIE_STEP1_MERGE_CHUNKS' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REGENIE_STEP2' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REGENIE_STEP2_GENE_TESTS' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REGENIE_LOG_PARSER_STEP1' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REGENIE_LOG_PARSER_STEP2' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'DOWNLOAD_RSIDS' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'ANNOTATE_RESULTS' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'FILTER_RESULTS' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'MERGE_RESULTS' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'LIFTOVER_RESULTS' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REPORT' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REPORT_GENE_BASED_TESTS' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }

  withName: 'REPORT_INDEX' {
    cpus = { 1 * task.attempt }
    memory = { 1.GB * task.attempt }
  }
  
  errorStrategy = 'retry'
  maxRetries = 3
}


